<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste CorreÃ§Ã£o Loop</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Teste CorreÃ§Ã£o Loop Infinito</h1>
        
        <div class="test-section info">
            <h3>ğŸ“‹ Problema Identificado</h3>
            <p><strong>Problema:</strong> Loop infinito causado por `agentPermissions` nas dependÃªncias do `useEffect`</p>
            <p><strong>SoluÃ§Ã£o:</strong> Remover `agentPermissions` das dependÃªncias do `useEffect`</p>
            <p><strong>Resultado esperado:</strong> PÃ¡gina deve carregar normalmente sem loop</p>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ Teste de DependÃªncias do useEffect</h3>
            <button onclick="testarDependencias()">Testar DependÃªncias</button>
            <div id="resultado"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š Logs Detalhados</h3>
            <div id="logs"></div>
        </div>
    </div>

    <script>
        function log(message) {
            const logsDiv = document.getElementById('logs')
            const timestamp = new Date().toLocaleTimeString()
            logsDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`
        }

        function testarDependencias() {
            log('ğŸ” Testando dependÃªncias do useEffect...')
            
            // Simular dados
            const syncedAgents = {
                "65": { id: 65, nome: "JoÃ£o", usuario_id: 6 },
                "69": { id: 69, nome: "Teste Agente", usuario_id: 6 }
            }
            
            const userData = { id: "6" }
            
            // Simular agentPermissions (objeto que muda constantemente)
            let agentPermissions = {
                canViewAll: false,
                canManage: false,
                canViewOwn: true
            }
            
            let renderCount = 0
            
            // Simular useEffect ANTES da correÃ§Ã£o (com agentPermissions nas dependÃªncias)
            log('ğŸ” Simulando useEffect ANTES da correÃ§Ã£o...')
            for (let i = 0; i < 5; i++) {
                renderCount++
                log(`ğŸ”„ Render ${renderCount}: agentPermissions mudou, useEffect executado`)
                
                // Simular mudanÃ§a em agentPermissions (causa re-render)
                agentPermissions = { ...agentPermissions, canViewOwn: !agentPermissions.canViewOwn }
            }
            
            log(`âŒ ANTES: ${renderCount} renders causados por mudanÃ§as em agentPermissions`)
            
            // Simular useEffect DEPOIS da correÃ§Ã£o (sem agentPermissions nas dependÃªncias)
            log('ğŸ” Simulando useEffect DEPOIS da correÃ§Ã£o...')
            renderCount = 0
            
            for (let i = 0; i < 5; i++) {
                renderCount++
                log(`ğŸ”„ Render ${renderCount}: useEffect executado apenas quando syncedAgents ou userData mudam`)
                
                // Simular mudanÃ§a em agentPermissions (nÃ£o causa re-render)
                agentPermissions = { ...agentPermissions, canViewOwn: !agentPermissions.canViewOwn }
            }
            
            log(`âœ… DEPOIS: ${renderCount} renders controlados (sem loop)`)
            
            // Mostrar resultado
            const resultadoDiv = document.getElementById('resultado')
            resultadoDiv.innerHTML = `
                <h4>ğŸ“Š Resultado do Teste:</h4>
                <p><strong>ANTES da correÃ§Ã£o:</strong> Loop infinito causado por agentPermissions nas dependÃªncias</p>
                <p><strong>DEPOIS da correÃ§Ã£o:</strong> useEffect executa apenas quando necessÃ¡rio</p>
                <p><strong>DependÃªncias corretas:</strong> [syncedAgents, userData] (sem agentPermissions)</p>
                <p><strong>Resultado:</strong> âœ… Loop resolvido</p>
            `
            resultadoDiv.className = 'test-section success'
        }

        // Executar teste automaticamente
        window.onload = function() {
            log('ğŸ“‹ PÃ¡gina carregada. Clique em "Testar DependÃªncias" para executar o teste.')
        }
    </script>
</body>
</html>

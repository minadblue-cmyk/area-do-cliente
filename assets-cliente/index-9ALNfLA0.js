import{l as w,r as i,a as P,u as T,j as e,M as S,k as h}from"./index-CJnD_gLK.js";import{S as z}from"./save-D0EATYqx.js";import{R as D}from"./refresh-cw-Co52wWG9.js";import{T as q}from"./trash-2-BWDTMKj5.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],R=w("send",U);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],V=w("smile",L);function J(){const[u,p]=i.useState([]),[m,j]=i.useState(!0),[l,x]=i.useState(""),[y,f]=i.useState(!1),[b,g]=i.useState(null),t=P(a=>a.push),{userData:s}=T(),k=["😊","😄","😃","😁","😆","😅","😂","🤣","😇","🙂","🙃","😉","😌","😍","🥰","😘","😗","😙","😚","😋","😛","😝","😜","🤪","🤨","🧐","🤓","😎","🤩","🥳","😏","😒","😞","😔","😟","😕","🙁","☹️","😣","😖","😫","😩","🥺","😢","😭","😤","😠","😡","🤬","🤯","😳","🥵","🥶","😱","😨","😰","😥","😓","🤗","🤔","🤭","🤫","🤥","😶","😐","😑","😬","🙄","😯","😦","😧","😮","😲","🥱","😴","🤤","😪","😵","🤐","🥴","🤢","🤮","🤧","😷","🤒","🤕","🤑","🤠","😈","👿","👹","👺","🤡","💩","👻","💀","☠️","👽","👾","🤖","🎃","😺","😸","😹","😻","😼","😽","🙀","😿","😾","💰","💸","💳","💎","🏦","📊","📈","📉","💹","💱","💲","💵","💴","💶","💷","🪙","🏆","🥇","🥈","🥉","🏅","🎖️","⭐","🌟","✨","💫","⚡","🔥","💯","✅","✔️","👍","👎","👌","🤝","🤞","✌️","🤟","🤘","👏","🙌","👐","🤲","🤜","🤛","✊","👊","👋","🤚","🖐️","✋","🖖","🤏","🤙","👈","👉","👆","🖕","👇","☝️"];async function d(){console.log("🔄 Carregando saudações..."),j(!0);try{s?.empresa_id||console.warn("⚠️ AVISO: Usuário não possui empresa_id - usando fallback"),s?.perfil_id||console.warn("⚠️ AVISO: Usuário não possui perfil_id - usando fallback");const a={id:s?.id?parseInt(s.id):0,usuario_id:s?.id?parseInt(s.id):0,nome:s?.name||"",email:s?.mail||"",empresa_id:s?.empresa_id||0,perfil_id:s?.perfil_id||0,tipo:s?.perfil||"Administrador",role:s?.perfil||"Administrador"};console.log("Payload completo enviado para webhook-listar-saudacao:",a);const{data:o}=await h("webhook-listar-saudacao",{method:"POST",data:a});console.log("✅ Resposta recebida do webhook:",o),console.log("🔍 Estrutura da resposta:",JSON.stringify(o,null,2));let r=[];if(o?.data&&Array.isArray(o.data)){const n=[];o.data.forEach(c=>{c?.json?.data&&Array.isArray(c.json.data)&&n.push(...c.json.data)}),r=n}else o?.saudacoes&&Array.isArray(o.saudacoes)&&(r=o.saudacoes);r=r.filter((n,c,O)=>c===O.findIndex(C=>C.id===n.id)),console.log("📋 Saudações extraídas:",r),console.log("🔍 Tipo de saudacoes:",typeof r,"Array?",Array.isArray(r));const N=r.map(n=>({id:n.id?.toString()||"",title:"Saudação Personalizada",content:n.texto||"",createdAt:n.criado_em||new Date().toISOString()}));console.log("✅ Items finais:",N),p(N),g(new Date)}catch(a){console.error("Erro ao carregar saudações:",a),a.message?.includes("404")||a.message?.includes("Not Found")?t({kind:"warning",message:"Webhook não encontrado (404). Usando dados de exemplo."}):a.message?.includes("CORS")||a.message?.includes("cors")?t({kind:"error",message:"Erro de CORS: Configure o n8n para aceitar requisições de http://localhost:5175"}):t({kind:"error",message:`Erro ao carregar saudações: ${a.message||"Erro desconhecido"}`});const o=[{id:"1",title:"Saudação Personalizada",content:"Olá! Seja muito bem-vindo(a) à nossa empresa. Como posso ajudá-lo(a) hoje?",createdAt:new Date().toISOString()},{id:"2",title:"Saudação Personalizada",content:"Boa tarde! Espero que esteja tendo um excelente dia. Em que posso ser útil?",createdAt:new Date().toISOString()},{id:"3",title:"Saudação Personalizada",content:"Seja muito bem-vindo(a) a FITH CONSULTORIA FINANCEIRA! Estamos aqui para ajudar com suas necessidades financeiras.",createdAt:new Date().toISOString()}];p(o),g(new Date),t({kind:"info",message:"Exibindo saudações de exemplo para demonstração."})}finally{j(!1)}}i.useEffect(()=>{s&&d()},[s]),i.useEffect(()=>{const a=()=>{console.log("🔄 Página ganhou foco - recarregando saudações..."),s&&d()};return window.addEventListener("focus",a),()=>window.removeEventListener("focus",a)},[s]),i.useEffect(()=>{if(!s)return;console.log("🔄 Iniciando auto-refresh das saudações...");const a=setInterval(()=>{console.log("🔄 Auto-refresh executando..."),d()},3e4);return()=>{console.log("🔄 Parando auto-refresh das saudações..."),clearInterval(a)}},[s]);async function _(){if(!l.trim()){t({kind:"error",message:"Digite uma mensagem antes de salvar."});return}s?.empresa_id||console.warn("⚠️ AVISO: Usuário não possui empresa_id - usando fallback"),s?.perfil_id||console.warn("⚠️ AVISO: Usuário não possui perfil_id - usando fallback");try{const a={texto:l,usuario_id:s?.id?parseInt(s.id):0,nome:s?.name||"",email:s?.mail||"",empresa_id:s?.empresa_id||0,perfil_id:s?.perfil_id||0,ativo:!0};console.log("Payload completo enviado para webhook-salvar-saudacao:",a),await h("webhook-salvar-saudacao",{method:"POST",data:a}),x(""),t({kind:"success",message:"Saudação salva com sucesso!"}),await d()}catch(a){console.error("Erro ao salvar saudação:",a),t({kind:"error",message:`Erro ao salvar saudação: ${a.message||"Erro desconhecido"}`})}}function A(a){x(o=>o+a),f(!1)}async function E(a,o){s?.empresa_id||console.warn("⚠️ AVISO: Usuário não possui empresa_id - usando fallback"),s?.perfil_id||console.warn("⚠️ AVISO: Usuário não possui perfil_id - usando fallback");try{const r={usuario_id:s?.id?parseInt(s.id):0,saudacao_id:parseInt(o),content:a,empresa_id:s?.empresa_id||0};console.log("Payload completo enviado para webhook-agente-recebimento:",r),await h("webhook-agente-recebimento",{method:"POST",data:r}),t({kind:"success",message:"Saudação aplicada ao agente com sucesso!"}),await d()}catch(r){console.error("Erro ao aplicar saudação ao agente:",r),t({kind:"error",message:`Erro ao aplicar saudação ao agente: ${r.message||"Erro desconhecido"}`})}}async function I(a){console.log("deleteSaudacao chamada com ID:",a),s?.empresa_id||console.warn("⚠️ AVISO: Usuário não possui empresa_id - usando fallback"),s?.perfil_id||console.warn("⚠️ AVISO: Usuário não possui perfil_id - usando fallback");try{const o={id:parseInt(a),usuario_id:s?.id?parseInt(s.id):0,empresa_id:s?.empresa_id||0,perfil_id:s?.perfil_id||0};console.log("Payload enviado para webhook-deletar-saudacao:",o),console.log("Tentando requisição no-cors...");const r=await fetch("https://n8n-lavo-n8n.15gxno.easypanel.host/webhook/deletar-saudacao",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...o,_method:"DELETE"}),mode:"no-cors"});console.log("Resposta no-cors:",r),console.log("Status:",r.status),console.log("Type:",r.type),t({kind:"success",message:"Saudação deletada com sucesso! (requisição enviada)"}),await d()}catch(o){console.error("Erro ao deletar saudação:",o),console.log("Erro na requisição - deletando localmente"),t({kind:"info",message:"Erro na requisição - saudação removida localmente."}),p(r=>r.filter(v=>v.id!==a)),g(new Date)}}return s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground mb-2",children:"Saudação Personalizada"}),e.jsx("p",{className:"text-muted-foreground",children:"Crie e gerencie mensagens de saudação para o agente de prospecção"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),e.jsx("span",{children:"Nova Saudação Personalizada"})]}),e.jsxs("div",{className:"card-content space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Crie uma nova mensagem de saudação para o agente de prospecção"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:l,onChange:a=>x(a.target.value),placeholder:"Digite sua saudação personalizada aqui...",className:"w-full h-32 rounded-md bg-input border border-border px-4 py-3 text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring resize-none",maxLength:500}),e.jsxs("div",{className:"absolute bottom-3 right-3 flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>f(!y),className:"p-1 rounded hover:bg-muted/50 transition-colors",title:"Adicionar emoji",children:e.jsx(V,{className:"w-4 h-4 text-muted-foreground"})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[l.length,"/500"]})]})]}),y&&e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Escolha um emoji"}),e.jsx("button",{onClick:()=>f(!1),className:"text-muted-foreground hover:text-foreground",children:"✕"})]}),e.jsx("div",{className:"grid grid-cols-8 gap-2 max-h-32 overflow-y-auto",children:k.map((a,o)=>e.jsx("button",{onClick:()=>A(a),className:"p-2 text-lg hover:bg-muted/50 rounded transition-colors",title:a,children:a},o))})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("button",{onClick:_,disabled:!l.trim(),className:"btn btn-primary flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Salvar Saudação"]})})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Saudações Salvas"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Lista de saudações salvas anteriormente",b&&e.jsxs("span",{className:"ml-2 text-xs",children:["• Atualizada às ",b.toLocaleTimeString("pt-BR")]})]})]}),e.jsxs("button",{onClick:d,disabled:m,className:"btn btn-outline flex items-center gap-2 text-xs",title:"Recarregar lista",children:[e.jsx(D,{className:`w-4 h-4 ${m?"animate-spin":""}`}),"Atualizar"]})]})}),e.jsx("div",{className:"card-content",children:m?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-4",children:[Array.isArray(u)&&u.map(a=>e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4 space-y-3 hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-foreground",children:a.title}),e.jsx("div",{className:"text-sm text-foreground leading-relaxed",children:a.content})]}),e.jsx("div",{className:"flex items-center justify-end pt-2 border-t border-border",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>E(a.content,a.id),className:"btn btn-primary text-xs px-3 py-1 flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"}),"Aplicar ao Agente"]}),e.jsxs("button",{onClick:()=>I(a.id),className:"btn btn-destructive text-xs px-3 py-1 flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"}),"Excluir"]})]})})]},a.id)),Array.isArray(u)&&u.length===0&&!m&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(S,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nenhuma saudação salva encontrada"}),e.jsx("p",{className:"text-xs mt-1",children:"Crie sua primeira saudação personalizada acima"})]})]})})]})]}):e.jsxs("div",{className:"card p-6 text-center",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Acesso necessário"}),e.jsx("p",{className:"text-muted-foreground",children:"Faça login para gerenciar saudações personalizadas."})]})}export{J as default};

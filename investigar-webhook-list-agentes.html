<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investigar Webhook List Agentes</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
        .container { max-width: 1000px; margin: 0 auto; }
        .section { background: #2a2a2a; padding: 20px; margin: 10px 0; border-radius: 8px; }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .warning { color: #fbbf24; }
        .info { color: #60a5fa; }
        button { background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #2563eb; }
        pre { background: #1e1e1e; padding: 15px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Investigar Webhook List Agentes</h1>
        
        <div class="section">
            <h2>1. Testar Webhook com Diferentes Par√¢metros</h2>
            <button onclick="testarComParametros()">Testar com Par√¢metros</button>
            <div id="parametros"></div>
        </div>

        <div class="section">
            <h2>2. Verificar Webhook de Cria√ß√£o</h2>
            <button onclick="verificarCriacao()">Verificar Cria√ß√£o</button>
            <div id="criacao"></div>
        </div>

        <div class="section">
            <h2>3. Testar URL Direta</h2>
            <button onclick="testarUrlDireta()">Testar URL Direta</button>
            <div id="url-direta"></div>
        </div>

        <div class="section">
            <h2>4. Verificar Headers e M√©todos</h2>
            <button onclick="testarHeaders()">Testar Headers</button>
            <div id="headers"></div>
        </div>
    </div>

    <script>
        async function testarComParametros() {
            const resultDiv = document.getElementById('parametros')
            resultDiv.innerHTML = '<p class="info">üîÑ Testando webhook com diferentes par√¢metros...</p>'
            
            try {
                // Teste 1: Sem par√¢metros
                console.log('üîç Teste 1: Sem par√¢metros')
                const response1 = await fetch('https://n8n.code-iq.com.br/webhook/list-agentes', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                })
                const data1 = await response1.json()
                console.log('Resultado 1:', data1)
                
                // Teste 2: Com par√¢metros de usu√°rio
                console.log('üîç Teste 2: Com par√¢metros de usu√°rio')
                const response2 = await fetch('https://n8n.code-iq.com.br/webhook/list-agentes?usuario_id=28', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                })
                const data2 = await response2.json()
                console.log('Resultado 2:', data2)
                
                // Teste 3: POST com dados
                console.log('üîç Teste 3: POST com dados')
                const response3 = await fetch('https://n8n.code-iq.com.br/webhook/list-agentes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ usuario_id: 28 })
                })
                const data3 = await response3.json()
                console.log('Resultado 3:', data3)
                
                resultDiv.innerHTML = `
                    <h3 class="info">üìä Resultados dos Testes</h3>
                    <h4>Teste 1 - GET sem par√¢metros:</h4>
                    <p><strong>Status:</strong> ${response1.status}</p>
                    <pre>${JSON.stringify(data1, null, 2)}</pre>
                    
                    <h4>Teste 2 - GET com usuario_id=28:</h4>
                    <p><strong>Status:</strong> ${response2.status}</p>
                    <pre>${JSON.stringify(data2, null, 2)}</pre>
                    
                    <h4>Teste 3 - POST com usuario_id=28:</h4>
                    <p><strong>Status:</strong> ${response3.status}</p>
                    <pre>${JSON.stringify(data3, null, 2)}</pre>
                `
                
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`
            }
        }

        async function verificarCriacao() {
            const resultDiv = document.getElementById('criacao')
            resultDiv.innerHTML = '<p class="info">üîÑ Verificando webhook de cria√ß√£o...</p>'
            
            try {
                // Criar agente de teste
                const agentId = 'INVESTIGACAO_' + Date.now()
                const response = await fetch('https://n8n.code-iq.com.br/webhook/create-agente', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'create',
                        agent_name: 'Investiga√ß√£o List Agentes',
                        agent_type: 'investigacao-list-agentes',
                        agent_id: agentId,
                        user_id: '28',
                        descricao: 'Teste para investigar list-agentes',
                        icone: 'üîç',
                        cor: 'bg-red-500',
                        ativo: true
                    })
                })
                
                const data = await response.json()
                
                resultDiv.innerHTML = `
                    <h3 class="${response.ok ? 'success' : 'error'}">${response.ok ? '‚úÖ' : '‚ùå'} Webhook de Cria√ß√£o</h3>
                    <p><strong>Status:</strong> ${response.status}</p>
                    <p><strong>Agent ID:</strong> ${agentId}</p>
                    <p><strong>Resposta:</strong></p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                    
                    <p><strong>Pr√≥ximo passo:</strong> Aguarde 5 segundos e teste a listagem novamente</p>
                `
                
                // Aguardar e testar listagem
                setTimeout(async () => {
                    try {
                        const listResponse = await fetch('https://n8n.code-iq.com.br/webhook/list-agentes', {
                            method: 'GET',
                            headers: { 'Accept': 'application/json' }
                        })
                        const listData = await listResponse.json()
                        
                        resultDiv.innerHTML += `
                            <h4>Listagem ap√≥s 5 segundos:</h4>
                            <p><strong>Status:</strong> ${listResponse.status}</p>
                            <pre>${JSON.stringify(listData, null, 2)}</pre>
                        `
                    } catch (error) {
                        resultDiv.innerHTML += `<p class="error">‚ùå Erro na listagem: ${error.message}</p>`
                    }
                }, 5000)
                
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`
            }
        }

        async function testarUrlDireta() {
            const resultDiv = document.getElementById('url-direta')
            resultDiv.innerHTML = '<p class="info">üîÑ Testando URL direta...</p>'
            
            try {
                // Testar URL direta no navegador
                const url = 'https://n8n.code-iq.com.br/webhook/list-agentes'
                
                resultDiv.innerHTML = `
                    <h3 class="info">üåê Teste de URL Direta</h3>
                    <p><strong>URL:</strong> <a href="${url}" target="_blank">${url}</a></p>
                    <p><strong>Instru√ß√µes:</strong></p>
                    <ol>
                        <li>Clique no link acima para abrir em nova aba</li>
                        <li>Verifique se retorna dados JSON</li>
                        <li>Se retornar erro, o webhook pode n√£o estar funcionando</li>
                        <li>Se retornar [], pode ser que n√£o h√° agentes no banco</li>
                    </ol>
                `
                
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`
            }
        }

        async function testarHeaders() {
            const resultDiv = document.getElementById('headers')
            resultDiv.innerHTML = '<p class="info">üîÑ Testando diferentes headers...</p>'
            
            try {
                const testes = [
                    { name: 'GET com Accept: application/json', method: 'GET', headers: { 'Accept': 'application/json' } },
                    { name: 'GET com Content-Type: application/json', method: 'GET', headers: { 'Content-Type': 'application/json' } },
                    { name: 'GET com ambos headers', method: 'GET', headers: { 'Accept': 'application/json', 'Content-Type': 'application/json' } },
                    { name: 'POST com Accept: application/json', method: 'POST', headers: { 'Accept': 'application/json' } },
                    { name: 'POST com Content-Type: application/json', method: 'POST', headers: { 'Content-Type': 'application/json' } }
                ]
                
                let resultados = []
                
                for (const teste of testes) {
                    try {
                        const response = await fetch('https://n8n.code-iq.com.br/webhook/list-agentes', {
                            method: teste.method,
                            headers: teste.headers
                        })
                        const data = await response.json()
                        resultados.push({
                            nome: teste.name,
                            status: response.status,
                            data: data,
                            success: response.ok
                        })
                    } catch (error) {
                        resultados.push({
                            nome: teste.name,
                            error: error.message,
                            success: false
                        })
                    }
                }
                
                resultDiv.innerHTML = `
                    <h3 class="info">üìã Resultados dos Headers</h3>
                    ${resultados.map(r => `
                        <div style="margin: 10px 0; padding: 10px; background: #1e1e1e; border-radius: 5px;">
                            <h4 class="${r.success ? 'success' : 'error'}">${r.nome}</h4>
                            ${r.success ? `
                                <p><strong>Status:</strong> ${r.status}</p>
                                <pre>${JSON.stringify(r.data, null, 2)}</pre>
                            ` : `
                                <p class="error"><strong>Erro:</strong> ${r.error}</p>
                            `}
                        </div>
                    `).join('')}
                `
                
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`
            }
        }

        // Auto-executar
        window.onload = function() {
            testarComParametros()
        }
    </script>
</body>
</html>

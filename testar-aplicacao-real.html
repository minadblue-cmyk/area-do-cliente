<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testar Aplica√ß√£o Real</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
        .container { max-width: 1000px; margin: 0 auto; }
        .section { background: #2a2a2a; padding: 20px; margin: 10px 0; border-radius: 8px; }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .warning { color: #fbbf24; }
        .info { color: #60a5fa; }
        button { background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #2563eb; }
        pre { background: #1e1e1e; padding: 15px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Testar Aplica√ß√£o Real</h1>
        
        <div class="section">
            <h2>1. Simular Exatamente o que a Aplica√ß√£o Faz</h2>
            <button onclick="simularAplicacao()">Simular Aplica√ß√£o</button>
            <div id="aplicacao"></div>
        </div>

        <div class="section">
            <h2>2. Testar Parsing da Resposta</h2>
            <button onclick="testarParsing()">Testar Parsing</button>
            <div id="parsing"></div>
        </div>

        <div class="section">
            <h2>3. Verificar Estrutura da Resposta</h2>
            <button onclick="verificarEstrutura()">Verificar Estrutura</button>
            <div id="estrutura"></div>
        </div>
    </div>

    <script>
        async function simularAplicacao() {
            const resultDiv = document.getElementById('aplicacao')
            resultDiv.innerHTML = '<p class="info">üîÑ Simulando aplica√ß√£o real...</p>'
            
            try {
                // Simular exatamente o que a aplica√ß√£o faz
                const response = await fetch('https://n8n.code-iq.com.br/webhook/list-agentes', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                })
                
                const data = await response.json()
                console.log('üì° Resposta do webhook:', data)
                
                // Simular a l√≥gica da aplica√ß√£o
                let agentesList = []
                
                if (Array.isArray(data)) {
                    agentesList = data
                    console.log('üì¶ Formato: Array direto')
                } else if (data.data && Array.isArray(data.data)) {
                    agentesList = data.data
                    console.log('üì¶ Formato: data.data array')
                } else if (data.success && data.data) {
                    agentesList = data.data
                    console.log('üì¶ Formato: success.data array')
                }
                
                console.log('üìä Agentes encontrados:', agentesList.length)
                console.log('üìä Agentes:', agentesList)
                
                resultDiv.innerHTML = `
                    <h3 class="info">üîß Simula√ß√£o da Aplica√ß√£o Real</h3>
                    <p><strong>Status da resposta:</strong> ${response.status}</p>
                    <p><strong>Tipo da resposta:</strong> ${typeof data}</p>
                    <p><strong>√â array:</strong> ${Array.isArray(data)}</p>
                    <p><strong>Success:</strong> ${data.success}</p>
                    <p><strong>Message:</strong> ${data.message}</p>
                    <p><strong>Total:</strong> ${data.total}</p>
                    
                    <h4>Estrutura da resposta:</h4>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                    
                    <h4>Agentes extra√≠dos:</h4>
                    <p><strong>Quantidade:</strong> ${agentesList.length}</p>
                    <ul>
                        ${agentesList.map(agente => `
                            <li>
                                <strong>${agente.nome}</strong> (ID: ${agente.id})
                                <br>usuario_id: ${agente.usuario_id}
                            </li>
                        `).join('')}
                    </ul>
                    
                    <h4>Conclus√£o:</h4>
                    <p class="${agentesList.length === 3 ? 'success' : 'error'}">
                        ${agentesList.length === 3 ? 
                            '‚úÖ CORRETO: Aplica√ß√£o consegue extrair 3 agentes' : 
                            '‚ùå INCORRETO: Aplica√ß√£o n√£o consegue extrair agentes'}
                    </p>
                `
                
            } catch (error) {
                console.error('‚ùå Erro na simula√ß√£o:', error)
                resultDiv.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`
            }
        }

        async function testarParsing() {
            const resultDiv = document.getElementById('parsing')
            resultDiv.innerHTML = '<p class="info">üîÑ Testando parsing...</p>'
            
            try {
                const response = await fetch('https://n8n.code-iq.com.br/webhook/list-agentes', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                })
                
                const data = await response.json()
                
                // Testar diferentes formas de parsing
                const testes = [
                    {
                        nome: 'Array direto',
                        resultado: Array.isArray(data) ? data : null,
                        sucesso: Array.isArray(data) && data.length > 0
                    },
                    {
                        nome: 'data.data array',
                        resultado: data.data && Array.isArray(data.data) ? data.data : null,
                        sucesso: data.data && Array.isArray(data.data) && data.data.length > 0
                    },
                    {
                        nome: 'success.data array',
                        resultado: data.success && data.data && Array.isArray(data.data) ? data.data : null,
                        sucesso: data.success && data.data && Array.isArray(data.data) && data.data.length > 0
                    },
                    {
                        nome: 'data[0].data array',
                        resultado: Array.isArray(data) && data[0] && data[0].data && Array.isArray(data[0].data) ? data[0].data : null,
                        sucesso: Array.isArray(data) && data[0] && data[0].data && Array.isArray(data[0].data) && data[0].data.length > 0
                    }
                ]
                
                resultDiv.innerHTML = `
                    <h3 class="info">üîç Teste de Parsing</h3>
                    <p><strong>Resposta original:</strong></p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                    
                    <h4>Resultados dos testes:</h4>
                    <ul>
                        ${testes.map(teste => `
                            <li>
                                <strong>${teste.nome}:</strong> 
                                ${teste.sucesso ? '‚úÖ SUCESSO' : '‚ùå FALHOU'}
                                <br>Agentes: ${teste.resultado ? teste.resultado.length : 0}
                                ${teste.resultado ? `
                                    <br>Primeiro agente: ${teste.resultado[0]?.nome || 'N/A'}
                                ` : ''}
                            </li>
                        `).join('')}
                    </ul>
                    
                    <h4>Conclus√£o:</h4>
                    <p class="info">‚ÑπÔ∏è O formato correto √©: <strong>data.success && data.data && Array.isArray(data.data)</strong></p>
                `
                
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Erro: ${error.message}</p>`
            }
        }

        function verificarEstrutura() {
            const resultDiv = document.getElementById('estrutura')
            
            // Estrutura esperada baseada nos dados reais
            const estruturaEsperada = {
                success: true,
                message: "Agentes encontrados",
                data: [
                    {
                        id: 68,
                        nome: "Joana",
                        usuario_id: 5,
                        ativo: true
                    },
                    {
                        id: 65,
                        nome: "Jo√£o", 
                        usuario_id: 6,
                        ativo: true
                    },
                    {
                        id: 74,
                        nome: "Zeca",
                        usuario_id: 5,
                        ativo: true
                    }
                ],
                total: 3,
                timestamp: "2025-09-24T18:59:01.682Z"
            }
            
            resultDiv.innerHTML = `
                <h3 class="info">üìã Estrutura Esperada da Resposta</h3>
                <p><strong>Formato:</strong> Objeto com propriedades success, message, data, total, timestamp</p>
                <p><strong>data:</strong> Array de agentes</p>
                <p><strong>Total de agentes:</strong> 3</p>
                
                <h4>Estrutura completa:</h4>
                <pre>${JSON.stringify(estruturaEsperada, null, 2)}</pre>
                
                <h4>Como extrair agentes:</h4>
                <pre>
// M√©todo correto:
const agentes = data.data || []

// Verifica√ß√µes:
- data.success === true ‚úÖ
- Array.isArray(data.data) === true ‚úÖ  
- data.data.length === 3 ‚úÖ
                </pre>
                
                <h4>Problema na aplica√ß√£o real:</h4>
                <p class="warning">‚ö†Ô∏è A aplica√ß√£o pode estar esperando um formato diferente ou h√° um erro na l√≥gica de parsing</p>
            `
        }

        // Auto-executar
        window.onload = function() {
            simularAplicacao()
            testarParsing()
            verificarEstrutura()
        }
    </script>
</body>
</html>
